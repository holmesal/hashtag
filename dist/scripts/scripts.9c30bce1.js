(function(){"use strict";angular.module("shortwaveApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase"]).config(["$routeProvider",function(a){return a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/dashboard",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl",resolve:{user:function(a){return a.getUser()}}}).when("/:channel",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl",resolve:{channel:["ChannelUtils","$route",function(a,b){return a.getChannel(b.current.params.channel)}]}}).otherwise({redirectTo:"/dashboard"})}]).run(["$rootScope","$location","$firebase",function(a,b){return a.notAllowed=["discover","login"],a.firebaseURL="http://shortwave-dev.firebaseio.com",a.rootRef=new Firebase(a.firebaseURL),a.$on("$routeChangeError",function(){return console.log("failed to change route!!!")}),a.$on("$firebaseSimpleLogin:login",function(c,d){var e;return console.log("login event from app.coffee"),console.log(d),e=a.rootRef.child("users/"+d.uid+"/profile"),e.update({photo:d.thirdPartyUserData.picture.data.url,firstName:d.thirdPartyUserData.first_name}),b.path("/dashboard")}),a.$on("$firebaseSimpleLogin:logout",function(){return b.path("/")}),a.$on("$firebaseSimpleLogin:error",function(a,b){return console.error("error logging in with firebase"),console.error(b)})}])}).call(this),function(){"use strict";angular.module("shortwaveApp").controller("MainCtrl",["$scope","$rootScope","$location","$firebase","$firebaseSimpleLogin",function(a,b,c,d,e){return a.$auth=e(b.rootRef),a.login=function(){return a.auth.login("facebook")}}])}.call(this),function(){"use strict";angular.module("shortwaveApp").controller("AboutCtrl",["$scope",function(a){return a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}])}.call(this),function(){"use strict";angular.module("shortwaveApp").service("ChannelUtils",["$firebase","$q","$rootScope","User",function(a,b,c,d){var e;return e={getChannel:function(a){var d,e;return e=b.defer(),d=new Firebase(""+c.firebaseURL+"/channels/"+a),d.once("value",function(a){var b;return b=a.val(),b?e.resolve(b):e.reject("no channel exists")},function(a){return e.reject(a)}),e.promise},createChannel:function(a){var e,f,g,h,i;return f=b.defer(),a?(g={members:{},moderators:{},"public":!0},e=d.getAuthUser(),i=d.getUser(),g.members[""+e.uid]=!0,g.moderators[""+e.uid]=!0,h=c.rootRef.child("channels/"+a),h.set(g,function(b){var c;return b?f.reject(b):(c=i.$getRef().child("channels").child(a),c.setWithPriority({lastSeen:0},Date.now(),function(a){return a?f.reject(a):f.resolve()}))}),f.promise):void console.error("must pass a channel name")}}}])}.call(this),function(){"use strict";angular.module("shortwaveApp").controller("DashboardCtrl",["$scope","$rootScope","$filter","$firebase","user",function(a,b,c,d,e){return a.messages={},a.unreads={},a.currentChannel="",a.channelList=[],console.log(e),a.channelList=e.$child("channels"),a.$watch("channelList",function(e,f){var g,h,i,j,k,l,m,n,o;for(g=c("orderByPriority")(e),k=0,m=g.length;m>k;k++)h=g[k],console.log(h),a.messages[h.$id]||(console.log("adding channel "+h.$id),i=b.rootRef.child("/messages/"+h.$id),a.messages[h.$id]=d(i));for(o=c("orderByPriority")(f),l=0,n=o.length;n>l;l++)j=o[l],g[j.$id]||(console.log("deleting channel "+j.$id),delete a.messages[j.$id]);return console.log(a.messages),g.length>0&&!a.currentChannel?a.currentChannel=g[0].$id:void 0},!0)}])}.call(this),function(){"use strict";angular.module("shortwaveApp").directive("channellistitem",function(){return{template:"<div></div>",restrict:"E",link:function(){}}})}.call(this),function(){"use strict";angular.module("shortwaveApp").directive("createchannel",["ChannelUtils",function(a){return{templateUrl:"views/partials/createchannel.html",restrict:"E",link:function(b){return b.createChannel=function(){return console.log("creating channel: "+b.newChannelName),a.createChannel(b.newChannelName).then(function(){return console.log("created ok!"),b.takenError=!1,b.newChannelName=""})["catch"](function(a){return console.error("channel "+b.newChannelName+" could not be created!"),console.error(a),b.takenError=!0,b.lastTry=b.newChannelName})}}}}])}.call(this),function(){"use strict";angular.module("shortwaveApp").service("User",["$rootScope","$firebase","$firebaseSimpleLogin","$q",function(a,b,c,d){var e,f,g,h,i;return console.log("starting up!"),g=d.defer(),i=new Firebase(a.firebaseURL),f=new FirebaseSimpleLogin(i,function(b,c){return b?g.reject(b):c?(a.authUser=c,g.resolve(c)):(a.authUser=null,a.user=null,g.reject("No user is logged in"))}),h=d.defer(),g.promise.then(function(c){var d;return d=i.child("users").child(c.uid),a.user=b(d),a.$watch("user",function(a){return a?(console.log("got user"),h.resolve(a)):void 0})}),e={auth:f,getAuthUser:function(){return a.authUser?a.authUser:g.promise},getUser:function(){return console.log("getting user!"),a.user?a.user:h.promise}}}])}.call(this),function(){"use strict";angular.module("shortwaveApp").service("Channels",["$rootScope","$firebase","User",function(a,b,c){var d;return new(d=function(){function b(){var b;console.log("making channels@"),this.channelList="hi!!!!",this.user=c.getUser(),b=a.rootRef.child("users/"+this.user.$id+"/channels"),b.on("value",function(a){return function(b){return console.log("changed!"),console.log(b.val()),a.channelList=b.val()}}(this)),console.log(this.channelList)}return b}())}])}.call(this),function(){"use strict";angular.module("shortwaveApp").directive("composemessage",["$firebaseSimpleLogin","$rootScope",function(a,b){return{templateUrl:"views/partials/composemessage.html",restrict:"E",scope:{channel:"="},link:function(c){var d;return c.$watch("channel.$id",function(a){return a?console.log("directive saw channel change to "+a):void 0}),d=a(b.rootRef),d.$getCurrentUser().then(function(a){return c.user=a}),c.send=function(){var a;return a={type:"text",content:{text:c.messageText},owner:c.user.uid},a[".priority"]=Date.now(),console.log(JSON.stringify(a)),c.channel.$add(a).then(function(){return console.log("saved!"),c.messageText=""})["catch"](function(a){return console.error(a)})}}}}])}.call(this);